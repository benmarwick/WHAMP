# Model parameters and functions {#parameters}
```{r, echo=FALSE, include=FALSE}

####################################################################################
# Setup
####################################################################################
#-----------------------------------------------------------------------------------
# Load packages
#-----------------------------------------------------------------------------------

    library("tidyverse")
    library("psych") #To use "describe" function for continuous vars
    library("ggplot2")
    library("survey")
    library("knitr")
    library("kableExtra")

#-----------------------------------------------------------------------------------
# Load data
#-----------------------------------------------------------------------------------
    load(file="Data/InternetSurveySample.Rdata")
    load(file="Data/InternetSurvey_reweighted_all.Rdata")
    load(file="Data/InternetSurvey_reweighted_neg.Rdata")

# Set options
    opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
    options(knitr.table.format = "html") 
    
```

This section summarises the parameters defined for the model, with reference to their sources and limitations. It also lists key model functions that were modified for this project and describes the changes made.

```{r parameters, warning=FALSE}
# write a function to define the table structure and add a row to the table with a new parameter or attribute
param_table <- function(table, param, description, value, alt_value, sources){
    row <- cbind.data.frame("Parameter" = param, "Description" = description, "Value" = value, "Alternate value(s)" = alt_value, "Source(s)" = sources)

    if(is.na(table)){
        table <- row
    } else {
        table <- rbind.data.frame(table, row)
    }
   
    return(table)
}

# Add rows for each parameter
parameters <- param_table(NA, "time.unit", "Unit of time relative to one day", 7, NA, NA)
parameters <- param_table(parameters, "prop.H.KC", "Proportion of the population that lives in King County and is Hispanic", prop.table(svytable(~region + hbo, sample_rake_all, round=TRUE))[1,1], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.B.KC", "Proportion of the population that lives in King County and is black", prop.table(svytable(~region + hbo, sample_rake_all, round=TRUE))[1,2], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.O.KC", "Proportion of the population that lives in King County and is other race/ethnicity", prop.table(svytable(~region + hbo, sample_rake_all, round=TRUE))[1,3], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.H.OW", "Proportion of the population that lives in other Western WA counties and is Hispanic", prop.table(svytable(~region + hbo, sample_rake_all, round=TRUE))[2,1], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.B.OW", "Proportion of the population that lives in other Western WA counties and is black", prop.table(svytable(~region + hbo, sample_rake_all, round=TRUE))[2,2], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.O.OW", "Proportion of the population that lives in other Western WA counties and is other race/ethnicity", prop.table(svytable(~region + hbo, sample_rake_all, round=TRUE))[2,3], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.H.EW", "Proportion of the population that lives in Eastern WA counties and is Hispanic", prop.table(svytable(~region + hbo, sample_rake_all, round=TRUE))[3,1], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.B.EW", "Proportion of the population that lives in Eastern WA counties and is black", prop.table(svytable(~region + hbo, sample_rake_all, round=TRUE))[3,2], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.O.EW", "Proportion of the population that lives in Eastern Western WA counties and is other race/ethnicity", prop.table(svytable(~region + hbo, sample_rake_all, round=TRUE))[3,3], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.18to24", "Proportion of the population aged 18 to 24", prop.table(svytable(~age_cat_alt, sample_rake_all, round=TRUE))[1], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.25to29", "Proportion of the population aged 25 to 29", prop.table(svytable(~age_cat_alt, sample_rake_all, round=TRUE))[2], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.30to34", "Proportion of the population aged 30 to 34", prop.table(svytable(~age_cat_alt, sample_rake_all, round=TRUE))[3], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.35to39", "Proportion of the population aged 35 to 39", prop.table(svytable(~age_cat_alt, sample_rake_all, round=TRUE))[4], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.40to49", "Proportion of the population aged 40 to 49", prop.table(svytable(~age_cat_alt, sample_rake_all, round=TRUE))[5], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")
parameters <- param_table(parameters, "prop.50to59", "Proportion of the population aged 50 to 59", prop.table(svytable(~age_cat_alt, sample_rake_all, round=TRUE))[6], NA, "2011-2015 American Community Survey (ACS) 5-year estimates [@WA-census] and estimates of the size of the MSM population by county [@Grey2016]")

# Make a kable
rownames(parameters) <- NULL
kable(parameters, caption="Parameter values and sources", digits=c(0, 0, 4, 4, 0)) %>% kable_styling(full_width=F, position="center") %>% column_spec(1, width = "5cm") %>% column_spec(2, width = "10cm") %>% column_spec(3, width = "5cm") %>% column_spec(4, width = "8cm") %>% column_spec(5, width = "20cm") 
```

```{r functions}

```