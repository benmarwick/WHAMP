# Momentary degree and concurrency {#degree}
```{r, echo=FALSE, include=FALSE}
####################################################################################
# Setup
####################################################################################
#-----------------------------------------------------------------------------------
# Load packages
#-----------------------------------------------------------------------------------

    library("tidyverse")
    library("ggplot2")
    library("survey")
    library("knitr")
    library("xtable")
    library("kableExtra")

#-----------------------------------------------------------------------------------
# Load data
#-----------------------------------------------------------------------------------
    load(file="Data/InternetSurveySample.Rdata")
    load(file="Data/InternetSurvey_reweighted_all.Rdata")
    load(file="Data/InternetSurvey_reweighted_neg.Rdata")

# Set options
    opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
    options(knitr.table.format = "html") 
  
#-----------------------------------------------------------------------------------
# Change degree_main variable to factor and add labels have character labels
#-----------------------------------------------------------------------------------
    sample_rake_all$variables$degree_main <- factor(sample_rake_all$variables$degree_main, levels = c(0, 1), labels = c("No main", "Main"))

```

The tables and plots below show the distribution of active main and persistent partnerships. We use data from the re-weighted WHPP survey to estimate these parameters for both HIV-negative and HIV-positive nodes, as we do not have data specific to HIV-positive men.

## Degree distribution: overall

```{r degmatrix}
# Create degree distribution table
deg.matrix <- round(prop.table(svytable(~degree_main + degreecat_cas, sample_rake_all, round=FALSE)),4)

# Add margins
deg.matrix <- addmargins(deg.matrix, margin=c(1,2), sum, quiet = TRUE)
row.names(deg.matrix) <- c("No main", "Main", "Total")

kable(deg.matrix, col.names=c("0 pers", "1 pers", "2+ pers", "Total"), caption="Main and persistent degree distribution") %>% kable_styling(full_width=F, position="center") %>% row_spec(3, color="#1C91D7")  %>% column_spec(1, bold=T, color="black", width="2cm") %>% column_spec(2:5, width = "2cm") %>% column_spec(5, color="#1C91D7")

```

## Main partnership status by race/ethnicity and region
Descriptive analyses (section \@ref(explore_heterogeneity)) indicated that main partnership status varies by race/ethnicity and region, so we will include terms in the main partnership network model to account for this heterogeneity. Tables \@ref(tab:degmain_race) and \ref(tab:degmain_region), below, show the proportion of men who report a main partner by race/ethnicity and region.
```{r degmain_race}
deg.mainXrace <- round(prop.table(svytable(~degree_main + hbo, sample_rake_all, round=FALSE), 2), 4)

kable(deg.mainXrace, caption="Main degree by race/ethnicity") %>% kable_styling(full_width=F, position="center") %>% column_spec(1, bold=T, color="black", width="2cm") %>% column_spec(2:4, width = "2cm")
```
```{r degmain_region}
deg.mainXregion <- round(prop.table(svytable(~degree_main + region, sample_rake_all, round=FALSE), 2), 4)

kable(deg.mainXregion, caption="Main degree by region") %>% kable_styling(full_width=F, position="center") %>% column_spec(1, bold=T, color="black", width="2cm") %>% column_spec(2:4, width = "2cm")
```

## Persistent partnership status by age
In descriptive analyses (section \@ref(explore_heterogeneity)), men aged 40-49 appeared to have a higher likelihood of reporting persistent partners, concurrent persistent partners, and persistent partners concurrent with a main partner. In the model (in sensitivity analyses), we will repersent this by including a `nodefactor` term for age 40-49 in the persistent formation model to allow men aged 40-49 to have a higher probability of forming persistent ties, which will in turn result in more concurrent persistent partnerships. Table \@ref(tab:degpers_age40to49) shows the persistent degree distribution for men aged 40 to 49 compared to men of all other ages.

```{r degpers_age40to49}
# Persistent degree by age
pers.deg.age40to49 <- round(prop.table(svytable(~degreecat_cas, sample_rake_all[sample_rake_all$variables$age_cat_alt %in% "40-49"], round=FALSE)),4)
pers.deg.otherages <- round(prop.table(svytable(~degreecat_cas, sample_rake_all[!(sample_rake_all$variables$age_cat_alt %in% "40-49")], round=FALSE)),4)
pers.degXage <- rbind.data.frame(pers.deg.age40to49, pers.deg.otherages)
names(pers.degXage) <- c("None", "One", "Two or more")
row.names(pers.degXage) <- c("Age 40-49", "Other ages")

kable(pers.degXage, col.names=c("0 pers", "1 pers", "2+ pers"), caption="Persistent degree by age") %>% kable_styling(full_width=F, position="center") %>% column_spec(1, bold=T, color="black", width="2.5cm") %>% column_spec(2:4, width = "2cm")

```

## Concurrency
Overall, `r round(100*prop.table(svytable(~concurrent, sample_rake_all, round=FALSE)), 2)[2]`% of the re-weighted sample reported one or more concurrent partners. `r round(100*prop.table(svytable(~concurrent_pers, sample_rake_all, round=FALSE)), 2)[2]`% reported concurrent persistent partners, and `r round(100*prop.table(svytable(~degree_main + anypers, sample_rake_all, round=FALSE)), 2)[2,2]`% reported concurrent main and persistent partnerships.